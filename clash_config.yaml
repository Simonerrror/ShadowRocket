# CLASH VERGE REV (MIHOMO) CONFIG
# Filter: Vless Only | No RU/BY/UA
# Target: Windows (Tun Mode)

port: 7890
socks-port: 7891
allow-lan: false
mode: rule
log-level: info
ipv6: false
geoip-code: RU

# 1. TUN MODE
tun:
  enable: true
  stack: system 
  dns-hijack:
    - any:53
  auto-route: true
  auto-detect-interface: true

# 2. DNS (Fake-IP)
dns:
  enable: true
  listen: 0.0.0.0:1053
  ipv6: false
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - '+.lan'
    - '+.local'
    - '+.localhost'
    - '+.home.arpa'
    - '*.localdomain'
    - 'time.*.com'
    - 'time.*.gov'
    - 'time.*.edu'
    - 'time.windows.com'
    - 'time.apple.com'
    - 'time.android.com'
    - '*.ntp.org'
  default-nameserver:
    - 45.90.28.224
    - 45.90.30.224
    - 1.1.1.1
    - 8.8.8.8
  nameserver:
    - https://dns.nextdns.io/6b556f
  fallback:
    - 45.90.28.224
    - 45.90.30.224
    - 1.1.1.1
    - 8.8.8.8
  fallback-filter:
    geoip: false
    ipcidr:
      - 0.0.0.0/0

# 3. ПРОВАЙДЕРЫ 
proxy-providers:
  Main-Sub:
    type: http
    # ВСТАВЬ ССЫЛКУ НИЖЕ
    url: "<INSERT_SUBSCRIPTION_URL_HERE>" 
    interval: 3600
    path: ./proxies/main.yaml
    
    filter: '(?i)Vless' 
     
    exclude-filter: '(?i)(Russia|Belarus|Ukraine)'

    health-check:
      enable: true
      interval: 600
      url: http://www.gstatic.com/generate_204

rule-providers:
  whitelist_direct:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/Simonerrror/ShadowRocket/main/rules/whitelist_direct.list"
    path: ./rules/whitelist.yaml
    interval: 86400

  greylist_proxy:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/Simonerrror/ShadowRocket/main/rules/greylist_proxy.list"
    path: ./rules/greylist.yaml
    interval: 86400

  google_gemini:
    type: http
    behavior: classical
    format: text
    url: "https://raw.githubusercontent.com/Simonerrror/ShadowRocket/main/rules/google-gemini.list"
    path: ./rules/google_gemini.yaml
    interval: 86400

  google_full:
    type: http
    behavior: classical
    format: text
    url: "https://raw.githubusercontent.com/Simonerrror/ShadowRocket/main/rules/google.list"
    path: ./rules/google.yaml
    interval: 86400

  gemini_ip:
    type: http
    behavior: classical
    format: text
    url: "https://raw.githubusercontent.com/Simonerrror/ShadowRocket/main/rules/gemini_ip.list"
    path: ./rules/gemini_ip.yaml
    interval: 86400

  youtube:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/Simonerrror/ShadowRocket/main/rules/youtube.list"
    path: ./rules/youtube.yaml
    interval: 86400

  youtubemusic:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/Simonerrror/ShadowRocket/main/rules/youtubemusic.list"
    path: ./rules/youtubemusic.yaml
    interval: 86400

  microsoft:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/Simonerrror/ShadowRocket/main/rules/microsoft.list"
    path: ./rules/microsoft.yaml
    interval: 86400

  domains_community:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/Simonerrror/ShadowRocket/main/rules/domains_community.list"
    path: ./rules/domains_community.yaml
    interval: 86400

  domain_ips:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/Simonerrror/ShadowRocket/main/rules/domain_ips.list"
    path: ./rules/domain_ips.yaml
    interval: 86400

  voice_ports:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/Simonerrror/ShadowRocket/main/rules/voice_ports.list"
    path: ./rules/voice_ports.yaml
    interval: 86400

  telegram:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/Simonerrror/ShadowRocket/main/rules/telegram.list"
    path: ./rules/telegram.yaml
    interval: 86400

# 4. ГРУППЫ
proxy-groups:
  # Главный селектор
  - name: PROXY
    type: select
    proxies:
      - AUTO-MAIN
      - GOOGLE
      - DIRECT

  # Спец-группа для Google (NL VLESS + UAE VLESS, ручной выбор)
  - name: GOOGLE
    type: select
    use:
      - Main-Sub
    filter: '(?i)((Netherlands.*Vless|Vless.*Netherlands)|(UAE.*Vless|Vless.*UAE))'

  # Автовыбор (все остальные "чистые" Vless серверы)
  - name: AUTO-MAIN
    type: url-test
    use:
      - Main-Sub
    filter: '.*' 
    url: 'http://www.gstatic.com/generate_204'
    interval: 600
    tolerance: 100

# 5. ПРАВИЛА
rules:
  - AND,((NETWORK,UDP),(DST-PORT,443)),REJECT
  - AND,((NETWORK,UDP),(DST-PORT,853)),REJECT
  - RULE-SET,google_gemini,GOOGLE
  - RULE-SET,google_full,GOOGLE
  - RULE-SET,gemini_ip,GOOGLE,no-resolve
  - RULE-SET,youtube,GOOGLE
  - RULE-SET,youtubemusic,GOOGLE
  - RULE-SET,whitelist_direct,DIRECT
  - RULE-SET,greylist_proxy,PROXY
  - RULE-SET,microsoft,PROXY
  - RULE-SET,domains_community,PROXY
  - RULE-SET,domain_ips,PROXY,no-resolve
  - RULE-SET,voice_ports,PROXY
  - RULE-SET,telegram,PROXY
  - DOMAIN-SUFFIX,ru,DIRECT
  - DOMAIN-SUFFIX,xn--p1ai,DIRECT
  - DOMAIN-SUFFIX,su,DIRECT
  - GEOIP,RU,DIRECT
  - GEOIP,private,DIRECT
  - MATCH,PROXY
