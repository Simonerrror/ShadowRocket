# CLASH VERGE REV (MIHOMO) CONFIG
# Filter: Vless Only | No RU/BY/UA
# Target: Windows (Tun Mode)

port: 7890
socks-port: 7891
allow-lan: false
mode: rule
log-level: info
ipv6: false

# 1. TUN MODE
tun:
  enable: true
  stack: system
  dns-hijack:
    - any:53
  auto-route: true
  auto-detect-interface: true

# 2. DNS (Fake-IP)
dns:
  enable: true
  listen: 0.0.0.0:1053
  ipv6: false
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - '*'
    - '+.lan'
    - '+.local'
  nameserver:
    - https://1.1.1.1/dns-query
    - https://8.8.8.8/dns-query
  fallback:
    - https://8.8.8.8/dns-query
    - https://94.140.14.14/dns-query

# 3. ПРОВАЙДЕРЫ (С ФИЛЬТРАЦИЕЙ)
proxy-providers:
  Main-Sub:
    type: http
    # ВСТАВЬ ССЫЛКУ НИЖЕ
    url: ""
    interval: 3600
    path: ./proxies/main.yaml

    # Оставляем только то, где есть "Vless"
    filter: '(?i)Vless'

    # Жестко вырезаем регионы (аналог твоего Lookahead)
    exclude-filter: '(?i)(Russia|Belarus|Ukraine)'

    health-check:
      enable: true
      interval: 600
      url: http://www.gstatic.com/generate_204

rule-providers:
  whitelist_direct:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/Simonerrror/ShadowRocket/main/rules/whitelist_direct.list"
    path: ./rules/whitelist.yaml
    interval: 86400

  community_list:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/misha-tgshv/shadowrocket-configuration-file/main/community.list"
    path: ./rules/community.yaml
    interval: 86400

  google_full:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/Simonerrror/ShadowRocket/main/rules/google.list"
    path: ./rules/google.yaml
    interval: 86400

  telegram:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/Simonerrror/ShadowRocket/main/rules/telegram.list"
    path: ./rules/tg.yaml
    interval: 86400

# 4. ГРУППЫ
proxy-groups:
  # Главный селектор
  - name: PROXY
    type: select
    proxies:
      - AUTO-MAIN
      - GOOGLE
      - DIRECT

  # Спец-группа для Google (из отфильтрованного списка берем только NL/UAE)
  - name: GOOGLE
    type: url-test
    use:
      - Main-Sub
    filter: 'Netherlands\(R\)|UAE'
    url: 'http://www.gstatic.com/generate_204'
    interval: 300
    tolerance: 50

  # Автовыбор (все остальные "чистые" Vless серверы)
  - name: AUTO-MAIN
    type: url-test
    use:
      - Main-Sub
    filter: '.*'
    url: 'http://www.gstatic.com/generate_204'
    interval: 600
    tolerance: 100

# 5. ПРАВИЛА
rules:
  # 1. Белый список
  - RULE-SET,whitelist_direct,DIRECT

  # 2. Блокировка QUIC
  - AND,((NETWORK,UDP),(DST-PORT,443)),REJECT
  - AND,((NETWORK,UDP),(DST-PORT,853)),REJECT

  # 3. ПРЯМОЙ ЭФИР (Direct) - ВАЖНО: Выше community списка
  - DOMAIN-SUFFIX,twitch.tv,DIRECT
  - DOMAIN-SUFFIX,ttvnw.net,DIRECT

  # 4. GOOGLE (В спец-группу) - ВАЖНО: Выше community списка
  - RULE-SET,google_full,GOOGLE
  - DOMAIN-SUFFIX,youtube.com,GOOGLE
  - DOMAIN-SUFFIX,googlevideo.com,GOOGLE

  # 5. TELEGRAM
  - RULE-SET,telegram,PROXY

  # 6. ОБЩИЙ СПИСОК (Пылесос)
  - RULE-SET,community_list,PROXY

  # 7. ГЕО И ФИНАЛ
  - GEOIP,RU,DIRECT
  - GEOIP,private,DIRECT
  - MATCH,PROXY
